<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

				{% if commande.type == 'devis' %}
					<title>Devis</title>
				{% elseif commande.type == 'facture' %}
					<title>Facture</title>
				{% endif %}
		
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

	</head>
	<body>

		<div class="row ml-5 mr-5 mb-3 justify-content-between">
			<div>
				{% if commande.type == 'devis' %}
					<h1 style="font-size:100px;color:#30C8D9;" class=" text-center text-info">Devis</h1>
				{% elseif commande.type == 'facture' %}
					<h1 style="font-size:100px;color:#30C8D9;" class=" text-center text-info">Facture</h1>
				{% endif %}

			</div>
		</div>

		<br>

				{% if commande.type == 'devis' %}
					<h2 style="font-size:25px;"> Devis No. {{ commande.code }}</h2>
				{% elseif commande.type == 'facture' %}
					<h2 style="font-size:25px;"> Fact. Nu : {{ commande.code }}</h2>
				{% endif %}
		
			
			{# Add other properties of commande here if needed #}
			<h2 class="mt-2" style="font-size:25px;"> Tunis &nbsp; : &nbsp; {{commande.date | date('d/m/Y') }} </h2>
		
		<br>


		<div style="display: inline-block; margin-right: 20px; width: 35%;background-color:#BFBFBF;padding:15px;">
			 
			<h3 style="font-size:23px;">{{app.user.fullname}}</h3>	
			<h3 style="font-size:23px;">{{app.user.poste}}</h3>
			<h3 style="font-size:23px;">{{app.user.email}}</h3>
			<h3 style="font-size:23px;">STE KEBSI MULTICOM</h3>
			<h3 style="font-size:23px;">MF : {{app.user.mf}}</h3>

		</div>

		<div class="" style="display: inline-block; width: 35%; padding:13px; border: 1px solid #BFBFBF;">
			<h2>Client : {{ client.nomprenom }}</h2>
		</div>



		<br><br><br>

		<div style="display: block;">
				<table border="1" cellpadding="15" cellspacing="0" style="width: 100%; font-size: 1.2em;">
					<thead class="thead-dark" style="background-color: #30C8D9; color: white;">
						<tr>
							{# <th>Client</th> #}
							<th>Code</th>
							<th>DÃ©signation</th>
							<th>Qte</th>
							<th>PU.H.T</th>
							<th>R%</th>
							<th>TVA</th>
							<th>T.HT</th>
						</tr>
					</thead>
					<tbody>
							{% set totalHT = 0 %}
                            {% set Remise = 0 %}
                            {% set totalRemise = 0 %}
                            {% set totalTVA = 0 %}

						 {% set item = commande %}
							{% set numRows = item.commandemateriels|length %}
							{% for commande_materiel in item.commandemateriels %}
								<tr>
                                    {% if loop.first %}
                                        {# <td rowspan="{{ numRows }}">{{ item.client.nomprenom }}</td> #}
                                        <td rowspan="{{ numRows }}">{{ item.code }}</td>
                                        
                                    {% endif %}

                                    <td>{{ commande_materiel.materiel.nom }}</td>
                                    <td>{{ commande_materiel.qte }}</td>
                                    <td>{{ commande_materiel.prix|number_format(0, '.', ' ') }}</td>
                                    <td>{{ commande_materiel.remise|number_format(2, '.', ' ') }}</td>
                                    <td>{{ commande_materiel.tva|number_format(0, '.', ' ') }} %</td>
                                    <td>{{ (commande_materiel.prix * commande_materiel.qte)|number_format(0, '.', ' ') }}</td>
                                    

                                </tr>

								{% set totalHT = totalHT + (commande_materiel.prix * commande_materiel.qte ) %}
                                {% set Remise = commande_materiel.prix * ( commande_materiel.remise / 100 )  %}
                                {% set totalRemise = totalRemise + Remise  %}
                                {% set totalTVA = totalTVA + ( ( commande_materiel.prix * commande_materiel.qte ) * commande_materiel.tva / 100 ) %}

							{% endfor %}
						

						 {% set totalTTC = totalHT + totalTVA + commande.timbre %}
						 {# Subtract total remise from total TTC if total remise is greater than 0 #}
                            {% if totalRemise > 0 %}
                                {% set totalTTC = totalTTC - totalRemise %}
                            {% endif %}

						<tr style="border-bottom: 2px solid black;"></tr>
					</tbody>
				</table>
		</div>

		<br><br><br>

					<div style="display: inline-block; margin-right: 40px; width: 40%;">
				
					
						<table border="1" cellpadding="20" cellspacing="0" class="table table-striped table-bordered">
							<thead class="">
								<tr>
									<th style="font-size: 1.2em;">TVA %</th>
									<th style="font-size: 1.2em;">Montant TVA</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td style="font-size: 1.2em;">19 %</td>
                                    <td style="font-size: 1.2em;">{{ totalTVA|number_format(3, '.', ' ') }}</td>
								</tr>
							</tbody>
						</table>
					
					</div>
					
					<div class=" mt-4" style="display: inline-block; width: 55%;">
						<table border="1" cellpadding="20" cellspacing="0" class="table table-striped table-bordered">
								<tr>
                                    <th style="font-size: 1.2em;">Total H.T</th>
                                    <td style="font-size: 1.2em;">{{ totalHT|number_format(0, '.', ' ') }}</td>
                                </tr>
                                <tr>
                                    <th style="font-size: 1.2em;">Total Remise</th>
                                    <td style="font-size: 1.2em;">{{ totalRemise|number_format(3, '.', ' ') }}</td>
                                </tr>
                                <tr>
                                    <th style="font-size: 1.2em;">Total TVA</th>
                                    <td style="font-size: 1.2em;">{{ totalTVA|number_format(0, '.', ' ') }}</td>
                                </tr>
                                <tr>
                                    <th style="font-size: 1.2em;">TIMBRE</th>
                                    <td style="font-size: 1.2em;">{{ commande.timbre }}</td>
                                </tr>
                                <tr>
                                    <th style="font-size: 1.2em;">Total TTC</th>
                                    <td style="font-size: 1.2em;">{{ totalTTC|number_format(3, '.', ' ') }}</td>
                                </tr>
						</table>
					
				
					</div>

	</body>
</html>
