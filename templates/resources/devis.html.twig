<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Devis</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

	</head>
	<body>

		<div class="row ml-5 mr-5 mb-3 justify-content-between">
			<div>
				<h1 style="font-size:50px;" class=" text-center text-info">Devis</h1>
			</div>
		</div>

		<br>
		
			<h3> <strong>Devis No. {{ commande.code }}</strong></h3>
			{# Add other properties of commande here if needed #}
			<h3 class="mt-2"> <strong>Tunis &nbsp; : &nbsp; {{commande.date | date('d/m/Y') }}</strong> </h3>
		
		<br>


		<div style="display: inline-block; margin-right: 20px; width: 40%;">
			 <table border="1" cellpadding="5" cellspacing="0" style="width: 100%; padding: 10px;">
				<tr>
					<td>{{app.user.fullname}}</td>
				</tr>
				<tr>
					<td>{{app.user.poste}}</td>
				</tr>
				<tr>
					<td>{{app.user.email}}</td>
				</tr>
				<tr>
					<td>STE KEBSI MULTICOM</td>
				</tr>
				<tr>
					<td>MF : {{app.user.mf}}</td>
				</tr>
			</table>
		</div>

		<div style="display: inline-block; width: 20%;">
			<table border="1" cellpadding="5" cellspacing="0" style="width: 100%; padding: 40%;">
				<tr>

					<td>Client : {{ client.nomprenom }}</td>
				</tr>

			</table>
		</div>


		<br><br><br>

		<div style="display: block;">
				<table border="1" cellpadding="5" cellspacing="0" style="width: 100%; font-size: 1.2em;">
					<thead class="thead-dark" style="background-color: #30C8D9; color: white;">
						<tr>
							{# <th>Client</th> #}
							<th>Code</th>
							<th>DÃ©signation</th>
							<th>Qte</th>
							<th>PU.H.T</th>
							<th>R%</th>
							<th>TVA</th>
							<th>T.HT</th>
						</tr>
					</thead>
					<tbody>
							{% set totalHT = 0 %}
                            {% set Remise = 0 %}
                            {% set totalRemise = 0 %}
                            {% set totalTVA = 0 %}

						 {% set item = commande %}
							{% set numRows = item.commandemateriels|length %}
							{% for commande_materiel in item.commandemateriels %}
								<tr>
                                    {% if loop.first %}
                                        {# <td rowspan="{{ numRows }}">{{ item.client.nomprenom }}</td> #}
                                        <td rowspan="{{ numRows }}">{{ item.code }}</td>
                                        
                                    {% endif %}

                                    <td>{{ commande_materiel.materiel.nom }}</td>
                                    <td>{{ commande_materiel.qte }}</td>
                                    <td>{{ commande_materiel.prix|number_format(0, '.', ' ') }}</td>
                                    <td>{{ commande_materiel.remise|number_format(2, '.', ' ') }}</td>
                                    <td>{{ commande_materiel.tva|number_format(0, '.', ' ') }} %</td>
                                    <td>{{ (commande_materiel.prix * commande_materiel.qte)|number_format(0, '.', ' ') }}</td>
                                    

                                </tr>

								{% set totalHT = totalHT + (commande_materiel.prix * commande_materiel.qte ) %}
                                {% set Remise = commande_materiel.prix * ( commande_materiel.remise / 100 )  %}
                                {% set totalRemise = totalRemise + Remise  %}
                                {% set totalTVA = totalTVA + ( ( commande_materiel.prix * commande_materiel.qte ) * commande_materiel.tva / 100 ) %}

							{% endfor %}
						

						 {% set totalTTC = totalHT + totalTVA + commande.timbre %}
						 {# Subtract total remise from total TTC if total remise is greater than 0 #}
                            {% if totalRemise > 0 %}
                                {% set totalTTC = totalTTC - totalRemise %}
                            {% endif %}

						<tr style="border-bottom: 2px solid black;"></tr>
					</tbody>
				</table>
		</div>

		<br><br><br>

					<div style="display: inline-block; margin-right: 40px; width: 40%;">
				
					
						<table class="table table-striped table-bordered">
							<thead class="">
								<tr>
									<th>TVA %</th>
									<th>Montant TVA</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>19 %</td>
                                    <td>{{ totalTVA|number_format(3, '.', ' ') }}</td>
								</tr>
							</tbody>
						</table>
					
					</div>
					
					<div class=" mt-4" style="display: inline-block; width: 55%;">
						<table class="table table-striped table-bordered">
								<tr>
                                    <th>Total H.T</th>
                                    <td>{{ totalHT|number_format(0, '.', ' ') }}</td>
                                </tr>
                                <tr>
                                    <th>Total Remise</th>
                                    <td>{{ totalRemise|number_format(3, '.', ' ') }}</td>
                                </tr>
                                <tr>
                                    <th>Total TVA</th>
                                    <td>{{ totalTVA|number_format(0, '.', ' ') }}</td>
                                </tr>
                                <tr>
                                    <th>TIMBRE</th>
                                    <td>{{ commande.timbre }}</td>
                                </tr>
                                <tr>
                                    <th>Total TTC</th>
                                    <td>{{ totalTTC|number_format(3, '.', ' ') }}</td>
                                </tr>
						</table>
					
				
					</div>

	</body>
</html>
